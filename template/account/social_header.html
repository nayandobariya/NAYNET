{% load static %}
<script>
  document.body.classList.add('social-page');
  // Force hide main site elements
  const siteNav = document.querySelector('.site-navbar');
  if (siteNav) siteNav.style.setProperty('display', 'none', 'important');

  const siteMobile = document.querySelector('.site-mobile-menu');
  if (siteMobile) siteMobile.style.setProperty('display', 'none', 'important');

  const siteFooter = document.querySelector('.site-footer');
  if (siteFooter) siteFooter.style.setProperty('display', 'none', 'important');
</script>

<style>
  :root {
    --header-height: 60px;
  }

  .social-header {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid rgba(0, 0, 0, 0.08);
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 1000;
    height: var(--header-height);
    display: flex;
    align-items: center;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.02);
  }

  .social-header-container {
    max-width: 1128px;
    margin: 0 auto;
    width: 100%;
    padding: 0 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .header-left {
    display: flex;
    align-items: center;
    flex: 1;
    gap: 12px;
  }

  .social-logo img {
    height: 34px;
    width: auto;
    transition: transform 0.2s;
  }

  .social-logo:hover img {
    transform: scale(1.05);
  }

  .header-search {
    position: relative;
    max-width: 280px;
    width: 100%;
  }

  .header-search i {
    position: absolute;
    left: 12px;
    top: 50%;
    transform: translateY(-50%);
    color: #666;
    font-size: 14px;
  }

  .header-search input {
    width: 100%;
    height: 34px;
    background: #eef3f8;
    border: none;
    border-radius: 4px;
    padding-left: 36px;
    font-size: 14px;
    transition: all 0.2s;
  }

  .header-search input:focus {
    background: #fff;
    box-shadow: 0 0 0 1px #0a66c2;
    max-width: 400px;
  }

  .social-nav-list {
    display: flex;
    list-style: none;
    margin: 0;
    padding: 0;
    height: 100%;
  }

  .social-nav-item {
    height: 100%;
    display: flex;
    align-items: center;
  }

  .social-nav-link {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 0 12px;
    height: var(--header-height);
    color: #666;
    text-decoration: none !important;
    font-size: 12px;
    position: relative;
    transition: color 0.2s;
    min-width: 80px;
  }

  .social-nav-link:hover {
    color: #000;
  }

  .social-nav-link.active {
    color: #000;
  }

  .social-nav-link.active::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 12px;
    right: 12px;
    height: 2px;
    background: #000;
  }

  .social-nav-link i {
    font-size: 20px;
    margin-bottom: 2px;
  }

  .nav-badge {
    position: absolute;
    top: 4px;
    right: 20px;
    background: #d11124;
    color: white;
    font-size: 10px;
    padding: 1px 5px;
    border-radius: 10px;
    font-weight: bold;
    min-width: 16px;
    text-align: center;
    border: 2px solid #fff;
  }

  .user-nav-avatar {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    object-fit: cover;
    margin-bottom: 2px;
  }

  @media (max-width: 850px) {
    .social-nav-link span {
      display: none;
    }

    .social-nav-link {
      min-width: 50px;
      padding: 0 8px;
    }

    .header-search {
      display: none;
    }
  }

  /* User Dropdown Premium Style */
  .premium-dropdown {
    border: none;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    border-radius: 8px;
    margin-top: 4px;
    overflow: hidden;
  }

  .dropdown-user-header {
    background: #fff;
    padding: 12px 16px;
  }

  .btn-view-profile {
    border-color: #0a66c2;
    color: #0a66c2;
    font-weight: 600;
    border-radius: 1600px;
    transition: all 0.2s;
  }

  .btn-view-profile:hover {
    background: rgba(10, 102, 194, 0.1);
    border-color: #0a66c2;
    color: #064482;
  }
</style>

<header class="social-header">
  <div class="social-header-container">
    <div class="header-left">
      <div class="social-logo">
        <a href="{% url 'account:posts' %}">
          <img src="{% static 'images/naynet_logo.png' %}" alt="NayNet">
        </a>
      </div>

      <div class="header-search">
        <i class="fas fa-search"></i>
        <input type="text" placeholder="Search" id="global-search-input">
      </div>
    </div>

    <nav class="social-nav">
      <ul class="social-nav-list">
        <li class="social-nav-item">
          <a href="{% url 'account:posts' %}"
            class="social-nav-link {% if request.resolver_match.url_name == 'posts' %}active{% endif %}">
            <i class="fas fa-home"></i>
            <span>Home</span>
          </a>
        </li>

        <li class="social-nav-item">
          <a href="{% url 'account:network' %}"
            class="social-nav-link {% if request.resolver_match.url_name == 'network' %}active{% endif %}">
            <i class="fas fa-user-friends"></i>
            <span>Network</span>
            <span class="nav-badge" id="nav-network-badge" style="display:none;">0</span>
          </a>
        </li>

        <li class="social-nav-item">
          <a href="{% url 'jobapp:home' %}" class="social-nav-link">
            <i class="fas fa-briefcase"></i>
            <span>Jobs</span>
          </a>
        </li>

        <li class="social-nav-item">
          <a href="{% url 'account:messages' %}"
            class="social-nav-link {% if request.resolver_match.url_name == 'messages' %}active{% endif %}">
            <i class="fas fa-comment-dots"></i>
            <span>Messaging</span>
            <span class="nav-badge" id="nav-message-badge" style="display:none;">0</span>
          </a>
        </li>

        <li class="social-nav-item">
          <a href="{% url 'account:notifications' %}"
            class="social-nav-link {% if request.resolver_match.url_name == 'notifications' %}active{% endif %}">
            <i class="fas fa-bell"></i>
            <span>Notifications</span>
            <span class="nav-badge" id="nav-notification-badge" style="display:none;">0</span>
          </a>
        </li>

        {% if user.is_authenticated %}
        <li class="social-nav-item dropdown ml-2 border-left pl-2" style="border-color: #eee !important;">
          <a href="#" class="social-nav-link dropdown-toggle" id="userDropdown" data-toggle="dropdown"
            aria-haspopup="true" aria-expanded="false">
            <img
              src="{% if user.profile_picture %}{{ user.profile_picture.url }}{% else %}{% static 'images/person_1.jpg' %}{% endif %}"
              class="user-nav-avatar">
            <span>Me <i class="fas fa-caret-down"></i></span>
          </a>
          <div class="dropdown-menu dropdown-menu-right premium-dropdown" aria-labelledby="userDropdown"
            style="width: 260px;">
            <div class="dropdown-user-header border-bottom">
              <div class="d-flex align-items-center mb-2">
                <img
                  src="{% if user.profile_picture %}{{ user.profile_picture.url }}{% else %}{% static 'images/person_1.jpg' %}{% endif %}"
                  style="width: 56px; height: 56px; border-radius: 50%; margin-right: 12px; object-fit: cover; border: 1px solid #eee;">
                <div style="overflow: hidden;">
                  <div class="font-weight-bold text-dark text-truncate">{{ user.get_full_name }}</div>
                  <div class="text-secondary small text-truncate">{{ user.role|title }}</div>
                </div>
              </div>
              <a href="{% url 'account:edit-profile' user.id %}"
                class="btn btn-outline-primary btn-sm btn-block btn-view-profile">View Profile</a>
            </div>

            <div class="p-2 border-bottom">
              <h6 class="dropdown-header font-weight-bold text-dark p-2">Account</h6>
              <a class="dropdown-item py-2 small" href="{% url 'account:edit-profile' user.id %}">Settings & Privacy</a>
              <a class="dropdown-item py-2 small" href="#">Help</a>
              <a class="dropdown-item py-2 small" href="#">Language</a>
            </div>

            <div class="p-2">
              <h6 class="dropdown-header font-weight-bold text-dark p-2">Manage</h6>
              <a class="dropdown-item py-2 small" href="#">Posts & Activity</a>
              <a class="dropdown-item py-2 small text-danger font-weight-bold" href="{% url 'account:logout' %}"
                onclick="if(window.pollingInterval) clearInterval(window.pollingInterval);">Sign Out</a>
            </div>
          </div>
        </li>
        {% endif %}
      </ul>
    </nav>
  </div>
</header>

<!-- Padding for fixed header -->
<div style="height: var(--header-height);"></div>

<script>
  function updateNavCounts() {
    {% if not user.is_authenticated %}
    return;
    {% endif %}

    fetch('{% url "account:notifications_count" %}', {
      headers: { 'X-Requested-With': 'XMLHttpRequest' }
    })
      .then(res => {
        if (res.status === 401 || res.status === 403) {
          // User logged out
          clearInterval(pollingInterval);
          return;
        }
        return res.json();
      })
      .then(data => {
        if (!data) return;

        // Notification Badge
        const nBadge = document.getElementById('nav-notification-badge');
        if (data.total_notifications > 0) {
          nBadge.textContent = data.total_notifications;
          nBadge.style.display = 'block';
        } else {
          nBadge.style.display = 'none';
        }

        // Message Badge
        const mBadge = document.getElementById('nav-message-badge');
        if (data.unread_messages > 0) {
          mBadge.textContent = data.unread_messages;
          mBadge.style.display = 'block';
        } else {
          mBadge.style.display = 'none';
        }

        // Network Badge
        const netBadge = document.getElementById('nav-network-badge');
        if (data.pending_requests > 0) {
          netBadge.textContent = data.pending_requests;
          netBadge.style.display = 'block';
        } else {
          netBadge.style.display = 'none';
        }
      })
      .catch(e => console.error('Error fetching count:', e));
  }

  window.pollingInterval = null;
  document.addEventListener('DOMContentLoaded', () => {
    updateNavCounts();
    window.pollingInterval = setInterval(updateNavCounts, 30000); // 30 seconds
  });
</script>